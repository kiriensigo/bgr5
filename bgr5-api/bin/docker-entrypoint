#!/bin/bash

set -e

# システム情報を簡素化
echo "Starting application in $RAILS_ENV environment"

# 最低限の環境変数チェック
if [ "$RAILS_ENV" = "production" ] && [ -z "$DATABASE_URL" ]; then
  export DATABASE_URL="postgres://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres}@${DATABASE_HOST:-localhost}:${DATABASE_PORT:-5432}/${DATABASE_NAME:-bgr5_production}"
  echo "Set DATABASE_URL to $DATABASE_URL"
fi

# 必要なディレクトリの作成
if [ -d "/rails" ]; then
  mkdir -p /rails/tmp/pids
  mkdir -p /rails/tmp/cache
  touch /rails/log/${RAILS_ENV}.log
fi

echo "Launching Rails application server..."
exec "$@" 